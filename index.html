<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fulus - –û–±–º–µ–Ω –≤–∞–ª—é—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sand-light: #F5E6D3;
            --sand: #D4A574;
            --sand-dark: #B8956C;
            --blue-deep: #1A365D;
            --blue-royal: #234E82;
            --blue-accent: #3B82A0;
            --blue-light: #5BA4C4;
            --gold: #C9A227;
            --gold-light: #E8D48B;
            --text-light: #F7FAFC;
            --bg-gradient: linear-gradient(165deg, #1A365D 0%, #234E82 40%, #2D5A7B 70%, #3B82A0 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(212, 165, 116, 0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0L60 30L30 60L0 30L30 0z' fill='none' stroke='%23D4A574' stroke-width='0.5' opacity='0.1'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }
        .container { position: relative; z-index: 1; max-width: 100%; padding: 0 16px 80px; }
        .header { text-align: center; padding: 24px 0 16px; }
        .logo { font-family: 'Amiri', serif; font-size: 42px; font-weight: 700; color: var(--sand); text-shadow: 0 2px 20px rgba(212, 165, 116, 0.4); letter-spacing: 4px; }
        .logo-arabic { font-family: 'Amiri', serif; font-size: 22px; color: var(--gold-light); opacity: 0.9; margin-top: 4px; direction: rtl; }
        .subtitle { font-size: 11px; text-transform: uppercase; letter-spacing: 3px; color: var(--blue-light); margin-top: 8px; font-weight: 500; }
        .decorative-line { display: flex; align-items: center; justify-content: center; gap: 12px; margin: 12px 0 20px; }
        .decorative-line::before, .decorative-line::after { content: ''; width: 60px; height: 1px; background: linear-gradient(90deg, transparent, var(--sand), transparent); }
        .decorative-diamond { width: 8px; height: 8px; background: var(--gold); transform: rotate(45deg); }
        .section-title { font-family: 'Amiri', serif; font-size: 20px; color: var(--sand); margin-bottom: 14px; display: flex; align-items: center; gap: 10px; }
        .section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--sand-dark), transparent); }
        
        .city-emoji { font-size: 40px; margin-bottom: 8px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        
        .city-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .city-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 14px 10px; text-align: center; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); position: relative; overflow: hidden; }
        .city-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--sand), var(--gold), var(--sand)); opacity: 0; transition: opacity 0.3s ease; }
        .city-card:hover, .city-card.active { background: rgba(212, 165, 116, 0.15); border-color: var(--sand); transform: translateY(-2px); }
        .city-card.active::before { opacity: 1; }
        .city-name { font-weight: 600; font-size: 14px; margin-bottom: 2px; }
        .city-currency { font-size: 11px; color: var(--sand-light); opacity: 0.7; display: flex; align-items: center; justify-content: center; gap: 4px; }
        
        .rates-container { display: none; margin-bottom: 20px; }
        .rates-container.visible { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .rate-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 16px; margin-bottom: 10px; backdrop-filter: blur(10px); }
        .rate-pair { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; }
        .currency-badge { background: linear-gradient(135deg, var(--blue-royal), var(--blue-accent)); padding: 6px 12px; border-radius: 10px; font-weight: 600; font-size: 13px; border: 1px solid rgba(212, 165, 116, 0.2); display: flex; align-items: center; gap: 6px; }
        .currency-icon { font-size: 14px; }
        .rate-arrow { color: var(--gold); font-size: 18px; }
        .rate-values { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .rate-item { text-align: center; padding: 10px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; }
        .rate-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--sand-light); opacity: 0.7; margin-bottom: 4px; }
        .rate-value { font-size: 20px; font-weight: 700; color: var(--sand); }
        .rate-currency { font-size: 11px; color: var(--blue-light); margin-top: 2px; }
        
        .exchange-section { display: none; }
        .exchange-section.visible { display: block; animation: fadeIn 0.4s ease; }
        .tabs { display: flex; background: var(--card-bg); border-radius: 14px; padding: 4px; margin-bottom: 16px; border: 1px solid var(--card-border); }
        .tab { flex: 1; padding: 12px; text-align: center; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s ease; color: var(--text-light); opacity: 0.6; }
        .tab.active { background: linear-gradient(135deg, var(--sand-dark), var(--gold)); color: var(--blue-deep); opacity: 1; box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3); }
        .form-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 20px 16px; backdrop-filter: blur(10px); }
        .pair-selector { margin-bottom: 16px; }
        .pair-selector label, .input-group label { display: block; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--sand-light); margin-bottom: 6px; }
        .pair-selector select, .input-group input { width: 100%; padding: 12px 14px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--card-border); border-radius: 10px; color: var(--text-light); font-size: 14px; font-family: 'Montserrat', sans-serif; }
        .pair-selector select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23D4A574' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; }
        .pair-selector select:focus, .input-group input:focus { outline: none; border-color: var(--sand); }
        .input-group { margin-bottom: 14px; }
        .input-group input::placeholder { color: rgba(255, 255, 255, 0.3); }
        .amount-display { background: linear-gradient(135deg, rgba(26, 54, 93, 0.8), rgba(35, 78, 130, 0.8)); border: 1px solid var(--gold); border-radius: 14px; padding: 14px; margin: 16px 0; text-align: center; }
        .amount-display-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--sand-light); margin-bottom: 4px; }
        .amount-display-value { font-size: 24px; font-weight: 700; color: var(--gold-light); }
        .submit-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--sand-dark), var(--gold)); border: none; border-radius: 12px; color: var(--blue-deep); font-size: 15px; font-weight: 700; font-family: 'Montserrat', sans-serif; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 2px; margin-top: 8px; box-shadow: 0 4px 20px rgba(212, 165, 116, 0.3); }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(212, 165, 116, 0.4); }
        .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, var(--blue-deep), rgba(26, 54, 93, 0.98)); padding: 10px 16px 16px; display: flex; justify-content: space-around; border-top: 1px solid var(--card-border); backdrop-filter: blur(20px); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; opacity: 0.6; transition: all 0.3s ease; padding: 6px 12px; }
        .nav-item.active { opacity: 1; }
        .nav-item.active .nav-icon { color: var(--gold); }
        .nav-item.active .nav-label { color: var(--sand); }
        .nav-icon { font-size: 20px; }
        .nav-label { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); display: none; align-items: center; justify-content: center; z-index: 200; padding: 20px; }
        .modal-overlay.visible { display: flex; animation: fadeIn 0.3s ease; }
        .modal { background: linear-gradient(165deg, var(--blue-deep), var(--blue-royal)); border: 1px solid var(--sand); border-radius: 20px; padding: 28px 20px; text-align: center; max-width: 300px; width: 100%; }
        .modal-icon { font-size: 56px; margin-bottom: 14px; }
        .modal-title { font-family: 'Amiri', serif; font-size: 22px; color: var(--sand); margin-bottom: 10px; }
        .modal-text { font-size: 13px; color: var(--sand-light); opacity: 0.8; margin-bottom: 20px; line-height: 1.5; }
        .modal-btn { padding: 12px 28px; background: linear-gradient(135deg, var(--sand-dark), var(--gold)); border: none; border-radius: 10px; color: var(--blue-deep); font-size: 13px; font-weight: 600; cursor: pointer; font-family: 'Montserrat', sans-serif; }
        
        .about-section { display: none; }
        .about-section.visible { display: block; animation: fadeIn 0.4s ease; }
        .about-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 16px; padding: 20px 16px; backdrop-filter: blur(10px); margin-bottom: 14px; }
        .about-title { font-family: 'Amiri', serif; font-size: 18px; color: var(--sand); margin-bottom: 14px; }
        .about-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px; }
        .about-icon { font-size: 18px; }
        .about-text { font-size: 13px; line-height: 1.4; color: var(--sand-light); }
        .about-text strong { color: var(--gold-light); }
        .contact-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 14px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; color: var(--text-light); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-family: 'Montserrat', sans-serif; margin-bottom: 10px; text-decoration: none; }
        .contact-btn:hover { background: rgba(212, 165, 116, 0.1); border-color: var(--sand); }

        /* Orders Section */
        .orders-section { display: none; }
        .orders-section.visible { display: block; animation: fadeIn 0.4s ease; }
        .order-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 14px; padding: 14px 16px; margin-bottom: 10px; backdrop-filter: blur(10px); }
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .order-id { font-weight: 600; color: var(--sand); font-size: 14px; }
        .order-status { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 500; }
        .order-status.pending { background: rgba(255, 193, 7, 0.2); color: #FFC107; }
        .order-status.completed { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
        .order-status.cancelled { background: rgba(244, 67, 54, 0.2); color: #F44336; }
        .order-details { font-size: 12px; color: var(--sand-light); }
        .order-details div { margin-bottom: 4px; display: flex; gap: 6px; }
        .order-amount { font-size: 14px; font-weight: 600; color: var(--gold-light); margin-top: 8px; }
        .empty-orders { text-align: center; padding: 40px 20px; color: var(--sand-light); }
        .empty-orders-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .empty-orders-text { font-size: 14px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">FULUS</div>
            <div class="logo-arabic">ŸÅŸèŸÑŸèŸàÿ≥</div>
            <div class="subtitle">–û–±–º–µ–Ω –≤–∞–ª—é—Ç</div>
        </header>
        <div class="decorative-line"><div class="decorative-diamond"></div></div>

        <!-- Main Section -->
        <div id="mainSection">
            <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</div>
            <div class="city-grid">
                <div class="city-card" data-city="mecca" onclick="selectCity('mecca')">
                    <div class="city-emoji">üïã</div>
                    <div class="city-name">–ú–µ–∫–∫–∞</div>
                    <div class="city-currency"><span>üá∏üá¶</span> SAR</div>
                </div>
                <div class="city-card" data-city="istanbul" onclick="selectCity('istanbul')">
                    <div class="city-emoji">üïå</div>
                    <div class="city-name">–°—Ç–∞–º–±—É–ª</div>
                    <div class="city-currency"><span>üáπüá∑</span> TRY</div>
                </div>
                <div class="city-card" data-city="dubai" onclick="selectCity('dubai')">
                    <div class="city-emoji">üèôÔ∏è</div>
                    <div class="city-name">–î—É–±–∞–π</div>
                    <div class="city-currency"><span>üá¶üá™</span> AED</div>
                </div>
                <div class="city-card" data-city="moscow" onclick="selectCity('moscow')">
                    <div class="city-emoji">üèõÔ∏è</div>
                    <div class="city-name">–ú–æ—Å–∫–≤–∞</div>
                    <div class="city-currency"><span>üá∑üá∫</span> RUB</div>
                </div>
            </div>
            
            <div id="ratesSection" class="rates-container">
                <div class="section-title">–ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞</div>
                <div id="ratesContent"></div>
            </div>
        </div>

        <!-- Exchange Section -->
        <div id="exchangeSection" class="exchange-section">
            <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</div>
            <div class="city-grid" id="exchangeCityGrid"></div>
            
            <div id="exchangeFormContainer" style="display: none;">
                <div class="section-title">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É</div>
                <div class="tabs">
                    <div class="tab active" data-type="buy" onclick="setExchangeType('buy')">–ö—É–ø–∏—Ç—å</div>
                    <div class="tab" data-type="sell" onclick="setExchangeType('sell')">–ü—Ä–æ–¥–∞—Ç—å</div>
                </div>
                <div class="form-card">
                    <div class="pair-selector">
                        <label>–í–∞–ª—é—Ç–Ω–∞—è –ø–∞—Ä–∞</label>
                        <select id="pairSelect" onchange="updateCalculation()"></select>
                    </div>
                    <div class="input-group">
                        <label id="amountLabel">–°—É–º–º–∞</label>
                        <input type="number" id="amountInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" oninput="updateCalculation()" inputmode="decimal">
                    </div>
                    <div class="amount-display">
                        <div class="amount-display-label">–í—ã –ø–æ–ª—É—á–∏—Ç–µ</div>
                        <div class="amount-display-value" id="resultAmount">0.00</div>
                    </div>
                    <div class="input-group">
                        <label>–í–∞—à–µ –∏–º—è</label>
                        <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="input-group">
                        <label>WhatsApp / –¢–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="tel" id="contactInput" placeholder="+7 999 123 45 67">
                    </div>
                    <button class="submit-btn" onclick="submitOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                </div>
            </div>
        </div>

        <!-- Orders Section -->
        <div id="ordersSection" class="orders-section">
            <div class="section-title">–ú–æ–∏ –∑–∞—è–≤–∫–∏</div>
            <div id="ordersContent"></div>
        </div>

        <!-- About Section -->
        <div id="aboutSection" class="about-section">
            <div class="section-title">–û –Ω–∞—Å</div>
            <div class="about-card">
                <div class="about-title">Fulus Exchange</div>
                <div class="about-item"><span class="about-icon">üåç</span><span class="about-text">–†–∞–±–æ—Ç–∞–µ–º –≤ <strong>4 –≥–æ—Ä–æ–¥–∞—Ö</strong>: –ú–µ–∫–∫–∞, –°—Ç–∞–º–±—É–ª, –î—É–±–∞–π, –ú–æ—Å–∫–≤–∞</span></div>
                <div class="about-item"><span class="about-icon">‚è∞</span><span class="about-text">–†–∞–±–æ—Ç–∞–µ–º –¥–ª—è –≤–∞—Å <strong>24/7</strong> ‚Äî –±–µ–∑ –æ–±–µ–¥–∞ –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö!</span></div>
                <div class="about-item"><span class="about-icon">üìä</span><span class="about-text"><strong>–°–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –∫—É—Ä—Å</strong> –Ω–∞ –ø–æ–∫—É–ø–∫—É –∏ –ø—Ä–æ–¥–∞–∂—É –≤–∞–ª—é—Ç—ã</span></div>
                <div class="about-item"><span class="about-icon">üí∞</span><span class="about-text"><strong>0% –∫–æ–º–∏—Å—Å–∏–∏</strong> ‚Äî –Ω–∏–∫–∞–∫–∏—Ö —Å–∫—Ä—ã—Ç—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π</span></div>
                <div class="about-item"><span class="about-icon">üîí</span><span class="about-text"><strong>–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏</strong> –∏ –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</span></div>
                <div class="about-item"><span class="about-icon">‚ö°</span><span class="about-text"><strong>–ë—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω</strong> ‚Äî –∑–∞—è–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞ 5-10 –º–∏–Ω—É—Ç</span></div>
            </div>
            <a href="https://t.me/daud_bank" target="_blank" class="contact-btn"><span>‚úàÔ∏è</span><span>–°–≤—è–∑–∞—Ç—å—Å—è –≤ Telegram</span></a>
            <a href="https://wa.me/1234567890" target="_blank" class="contact-btn"><span>üì±</span><span>–ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</span></a>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav">
        <div class="nav-item active" data-section="main" onclick="showSection('main')"><span class="nav-icon">üè†</span><span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span></div>
        <div class="nav-item" data-section="exchange" onclick="showSection('exchange')"><span class="nav-icon">üí±</span><span class="nav-label">–û–±–º–µ–Ω</span></div>
        <div class="nav-item" data-section="orders" onclick="showSection('orders')"><span class="nav-icon">üìã</span><span class="nav-label">–ó–∞—è–≤–∫–∏</span></div>
        <div class="nav-item" data-section="about" onclick="showSection('about')"><span class="nav-icon">‚ÑπÔ∏è</span><span class="nav-label">–û –Ω–∞—Å</span></div>
    </nav>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-icon">‚úÖ</div>
            <div class="modal-title">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</div>
            <div class="modal-text">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±–º–µ–Ω–∞.</div>
            <button class="modal-btn" onclick="closeModal()">–û—Ç–ª–∏—á–Ω–æ</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#1A365D'); tg.setBackgroundColor('#1A365D'); }

        const CITY_EMOJIS = { mecca: 'üïã', istanbul: 'üïå', dubai: 'üèôÔ∏è', moscow: 'üèõÔ∏è' };
        const CURRENCY_ICONS = { 'SAR': 'üá∏üá¶', 'TRY': 'üáπüá∑', 'AED': 'üá¶üá™', 'RUB': 'üá∑üá∫', 'USDT/USD': 'üíµ' };

        const RATES = {
            mecca: { name: '–ú–µ–∫–∫–∞', currency: 'SAR', pairs: [{ quote: 'USDT/USD', buy_rate: 3.75, sell_rate: 3.77 }, { quote: 'RUB', buy_rate: 0.038, sell_rate: 0.039 }] },
            istanbul: { name: '–°—Ç–∞–º–±—É–ª', currency: 'TRY', pairs: [{ quote: 'USDT/USD', buy_rate: 34.5, sell_rate: 35.0 }, { quote: 'RUB', buy_rate: 0.35, sell_rate: 0.36 }] },
            dubai: { name: '–î—É–±–∞–π', currency: 'AED', pairs: [{ quote: 'USDT/USD', buy_rate: 3.67, sell_rate: 3.69 }, { quote: 'RUB', buy_rate: 0.037, sell_rate: 0.038 }] },
            moscow: { name: '–ú–æ—Å–∫–≤–∞', currency: 'RUB', pairs: [{ quote: 'USDT/USD', buy_rate: 100.5, sell_rate: 101.5 }] }
        };

        let currentCity = null;
        let exchangeCity = null;
        let exchangeType = 'buy';
        let orders = JSON.parse(localStorage.getItem('fulus_orders') || '[]');

        function getIcon(currency) { return CURRENCY_ICONS[currency] || ''; }

        function selectCity(city) {
            currentCity = city;
            document.querySelectorAll('#mainSection .city-card').forEach(c => c.classList.remove('active'));
            document.querySelector(`#mainSection [data-city="${city}"]`)?.classList.add('active');
            updateRates();
            document.getElementById('ratesSection').classList.add('visible');
        }

        function selectExchangeCity(city) {
            exchangeCity = city;
            document.querySelectorAll('#exchangeCityGrid .city-card').forEach(c => c.classList.remove('active'));
            document.querySelector(`#exchangeCityGrid [data-city="${city}"]`)?.classList.add('active');
            document.getElementById('exchangeFormContainer').style.display = 'block';
            updatePairSelector();
            setTimeout(() => { document.getElementById('exchangeFormContainer').scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
        }

        function updateRates() {
            if (!currentCity) return;
            const city = RATES[currentCity];
            const local = city.currency;
            let html = '';
            city.pairs.forEach(pair => {
                html += `<div class="rate-card">
                    <div class="rate-pair">
                        <span class="currency-badge"><span class="currency-icon">${getIcon(local)}</span> ${local}</span>
                        <span class="rate-arrow">‚áÑ</span>
                        <span class="currency-badge"><span class="currency-icon">${getIcon(pair.quote)}</span> ${pair.quote}</span>
                    </div>
                    <div class="rate-values">
                        <div class="rate-item"><div class="rate-label">–ö—É–ø–∏—Ç—å ${local}</div><div class="rate-value">${pair.buy_rate}</div><div class="rate-currency">${local} –∑–∞ 1 ${pair.quote}</div></div>
                        <div class="rate-item"><div class="rate-label">–ü—Ä–æ–¥–∞—Ç—å ${local}</div><div class="rate-value">${pair.sell_rate}</div><div class="rate-currency">${local} –∑–∞ 1 ${pair.quote}</div></div>
                    </div>
                </div>`;
            });
            document.getElementById('ratesContent').innerHTML = html;
        }

        function updatePairSelector() {
            if (!exchangeCity) return;
            const city = RATES[exchangeCity];
            let html = '';
            city.pairs.forEach((pair, i) => {
                html += exchangeType === 'buy' 
                    ? `<option value="${i}">${getIcon(pair.quote)} ${pair.quote} ‚Üí ${getIcon(city.currency)} ${city.currency}</option>`
                    : `<option value="${i}">${getIcon(city.currency)} ${city.currency} ‚Üí ${getIcon(pair.quote)} ${pair.quote}</option>`;
            });
            document.getElementById('pairSelect').innerHTML = html;
            updateAmountLabel();
            updateCalculation();
        }

        function updateAmountLabel() {
            if (!exchangeCity) return;
            const city = RATES[exchangeCity];
            const pairIndex = parseInt(document.getElementById('pairSelect').value) || 0;
            const pair = city.pairs[pairIndex];
            const curr = exchangeType === 'buy' ? pair.quote : city.currency;
            document.getElementById('amountLabel').innerHTML = `–°—É–º–º–∞ –≤ ${getIcon(curr)} ${curr}`;
        }

        function setExchangeType(type) {
            exchangeType = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            updatePairSelector();
        }

        function updateCalculation() {
            if (!exchangeCity) { document.getElementById('resultAmount').textContent = '0.00'; return; }
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const pairIndex = parseInt(document.getElementById('pairSelect').value) || 0;
            const city = RATES[exchangeCity];
            const pair = city.pairs[pairIndex];
            let result, outputCurrency;
            if (exchangeType === 'buy') { result = amount * pair.buy_rate; outputCurrency = city.currency; }
            else { result = amount / pair.sell_rate; outputCurrency = pair.quote; }
            document.getElementById('resultAmount').textContent = `${result.toFixed(2)} ${getIcon(outputCurrency)} ${outputCurrency}`;
        }

        function populateExchangeCities() {
            let html = '';
            for (const [cityId, cityData] of Object.entries(RATES)) {
                html += `<div class="city-card" data-city="${cityId}" onclick="selectExchangeCity('${cityId}')">
                    <div class="city-emoji">${CITY_EMOJIS[cityId]}</div>
                    <div class="city-name">${cityData.name}</div>
                    <div class="city-currency"><span>${getIcon(cityData.currency)}</span> ${cityData.currency}</div>
                </div>`;
            }
            document.getElementById('exchangeCityGrid').innerHTML = html;
        }

        function renderOrders() {
            const container = document.getElementById('ordersContent');
            if (orders.length === 0) {
                container.innerHTML = `<div class="empty-orders">
                    <div class="empty-orders-icon">üìã</div>
                    <div class="empty-orders-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫</div>
                    <button class="submit-btn" onclick="showSection('exchange')">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                </div>`;
                return;
            }
            let html = '';
            orders.slice().reverse().forEach(order => {
                const statusClass = order.status === 'pending' ? 'pending' : order.status === 'completed' ? 'completed' : 'cancelled';
                const statusText = order.status === 'pending' ? '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' : order.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' : '–û—Ç–º–µ–Ω–µ–Ω–∞';
                html += `<div class="order-card">
                    <div class="order-header">
                        <span class="order-id">–ó–∞—è–≤–∫–∞ #${order.id}</span>
                        <span class="order-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="order-details">
                        <div>üìÖ ${order.date}</div>
                        <div>üèôÔ∏è ${order.city}</div>
                        <div>üí± ${order.type}</div>
                    </div>
                    <div class="order-amount">${order.give} ‚Üí ${order.receive}</div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function showSection(section) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            document.getElementById('mainSection').style.display = 'none';
            document.getElementById('exchangeSection').classList.remove('visible');
            document.getElementById('ordersSection').classList.remove('visible');
            document.getElementById('aboutSection').classList.remove('visible');
            
            if (section === 'main') {
                document.getElementById('mainSection').style.display = 'block';
            } else if (section === 'exchange') {
                document.getElementById('exchangeSection').classList.add('visible');
                populateExchangeCities();
                exchangeCity = null;
                document.getElementById('exchangeFormContainer').style.display = 'none';
            } else if (section === 'orders') {
                document.getElementById('ordersSection').classList.add('visible');
                renderOrders();
            } else if (section === 'about') {
                document.getElementById('aboutSection').classList.add('visible');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function submitOrder() {
            if (!exchangeCity) { alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥'); return; }
            const name = document.getElementById('nameInput').value.trim();
            const amount = document.getElementById('amountInput').value;
            if (!name || !amount) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Å—É–º–º—É'); return; }
            
            const contact = document.getElementById('contactInput').value.trim();
            const pairIndex = parseInt(document.getElementById('pairSelect').value) || 0;
            const city = RATES[exchangeCity];
            const pair = city.pairs[pairIndex];
            
            let result, inputCurrency, outputCurrency, rateDisplay;
            if (exchangeType === 'buy') {
                result = parseFloat(amount) * pair.buy_rate;
                inputCurrency = pair.quote; outputCurrency = city.currency;
                rateDisplay = `1 ${pair.quote} = ${pair.buy_rate} ${city.currency}`;
            } else {
                result = parseFloat(amount) / pair.sell_rate;
                inputCurrency = city.currency; outputCurrency = pair.quote;
                rateDisplay = `${pair.sell_rate} ${city.currency} = 1 ${pair.quote}`;
            }
            
            const orderId = Date.now().toString().slice(-6);
            const orderData = { 
                city: city.name, 
                type: exchangeType === 'buy' ? '–ü–æ–∫—É–ø–∫–∞' : '–ü—Ä–æ–¥–∞–∂–∞', 
                pair: `${inputCurrency} ‚Üí ${outputCurrency}`, 
                rate: rateDisplay, 
                amount: `${amount} ${inputCurrency}`, 
                result: `${result.toFixed(2)} ${outputCurrency}`, 
                name, 
                contact: contact || '–ù–µ —É–∫–∞–∑–∞–Ω' 
            };
            
            // Save to local storage
            const localOrder = {
                id: orderId,
                date: new Date().toLocaleString('ru-RU'),
                city: city.name,
                type: exchangeType === 'buy' ? '–ü–æ–∫—É–ø–∫–∞' : '–ü—Ä–æ–¥–∞–∂–∞',
                give: `${amount} ${inputCurrency}`,
                receive: `${result.toFixed(2)} ${outputCurrency}`,
                status: 'pending'
            };
            orders.push(localOrder);
            localStorage.setItem('fulus_orders', JSON.stringify(orders));
            
            // Send to Telegram
            if (tg) { tg.sendData(JSON.stringify(orderData)); }
            
            document.getElementById('successModal').classList.add('visible');
            document.getElementById('nameInput').value = '';
            document.getElementById('contactInput').value = '';
            document.getElementById('amountInput').value = '';
            updateCalculation();
        }

        function closeModal() { document.getElementById('successModal').classList.remove('visible'); }

        // Handle keyboard
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('focus', () => {
                document.getElementById('bottomNav').style.display = 'none';
                document.querySelector('.container').style.paddingBottom = '20px';
            });
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('bottomNav').style.display = 'flex';
                    document.querySelector('.container').style.paddingBottom = '80px';
                }, 100);
            });
        });

        document.addEventListener('DOMContentLoaded', () => { showSection('main'); });
    </script>
</body>
</html>
